<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مولد المقالات الذكي متعدد اللغات</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .article-content p {
            margin-bottom: 1rem;
            line-height: 1.8;
        }

        .featured-image {
            max-height: 400px;
            object-fit: cover;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <div class="max-w-6xl mx-auto p-6">
        <!-- Header Section -->
        <div class="bg-white rounded-2xl shadow-2xl p-8 mb-6">
            <div class="flex items-center justify-center mb-8">
                <svg class="w-10 h-10 text-indigo-600 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                </svg>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                    مولد المقالات الذكي
                </h1>
            </div>

            <!-- Form Section -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="flex items-center text-sm font-semibold text-gray-700 mb-2">
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"></path>
                        </svg>
                        اللغة
                    </label>
                    <select id="language" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all">
                        <option value="ar">العربية</option>
                        <option value="en">English</option>
                        <option value="fr">Français</option>
                    </select>
                </div>

                <div id="dialectDiv">
                    <label class="flex items-center text-sm font-semibold text-gray-700 mb-2">
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
                        </svg>
                        اللهجة
                    </label>
                    <select id="dialect" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all">
                        <option value="standard">فصحى</option>
                        <option value="dz">جزائرية</option>
                        <option value="eg">مصرية</option>
                        <option value="tn">تونسية</option>
                        <option value="ma">مغربية</option>
                        <option value="jo">أردنية</option>
                        <option value="sa">سعودية</option>
                    </select>
                </div>

                <div class="md:col-span-2">
                    <label class="flex items-center text-sm font-semibold text-gray-700 mb-2">
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        طول المقالة
                    </label>
                    <select id="articleLength" class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all">
                        <option value="short">2000 كلمة</option>
                        <option value="medium" selected>3000 كلمة</option>
                        <option value="long">5000 كلمة</option>
                    </select>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-2">موضوع المقالة</label>
                <input type="text" id="topic" placeholder="أدخل موضوع المقالة..." 
                    class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all">
            </div>

            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                    الكلمات المفتاحية (اختياري - سيتم توليدها تلقائياً)
                </label>
                <input type="text" id="keywords" placeholder="اتركه فارغاً للتوليد التلقائي، أو أدخل كلمات مخصصة" 
                    class="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 transition-all">
                <div id="generatedKeywordsDiv" class="mt-2 p-3 bg-green-50 border border-green-200 rounded-lg hidden">
                    <p class="text-sm text-green-800 font-semibold mb-1">الكلمات المفتاحية المولدة:</p>
                    <p id="generatedKeywords" class="text-sm text-green-700"></p>
                </div>
            </div>

            <button id="generateBtn" onclick="generateArticle()" 
                class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:from-indigo-700 hover:to-purple-700 transition-all transform hover:scale-105 flex items-center justify-center">
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                </svg>
                <span id="btnText">توليد المقالة</span>
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="bg-white rounded-2xl shadow-2xl p-8 hidden fade-in">
            <div class="mb-6">
                <h2 id="articleTitle" class="text-2xl font-bold text-gray-800 mb-4"></h2>
                
                <div id="imageContainer" class="mb-6 hidden">
                    <img id="articleImage" class="w-full h-auto rounded-xl shadow-lg featured-image">
                </div>
                
                <div class="flex gap-3 flex-wrap mb-6">
                    <button onclick="copyText()" class="flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all">
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        <span id="copyTextBtn">نسخ نص عادي</span>
                    </button>
                    <button onclick="copyHTML()" class="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all">
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                        </svg>
                        <span id="copyHTMLBtn">نسخ HTML</span>
                    </button>
                </div>
            </div>

            <div id="articleContent" class="prose prose-lg max-w-none bg-gray-50 p-6 rounded-lg border border-gray-200 article-content"></div>
        </div>
    </div>

    <script>
        let currentArticle = '';
        let currentTitle = '';
        let currentImage = '';
        let currentKeywords = '';
        let currentLanguage = 'ar';

        const lengthOptions = {
            short: 3000,
            medium: 4500,
            long: 7500
        };

        // Handle language change
        document.getElementById('language').addEventListener('change', function() {
            currentLanguage = this.value;
            const dialectDiv = document.getElementById('dialectDiv');
            const topic = document.getElementById('topic');
            const keywords = document.getElementById('keywords');
            
            if (currentLanguage === 'ar') {
                dialectDiv.classList.remove('hidden');
                topic.placeholder = 'أدخل موضوع المقالة...';
                keywords.placeholder = 'اتركه فارغاً للتوليد التلقائي، أو أدخل كلمات مخصصة';
                document.getElementById('btnText').textContent = 'توليد المقالة';
            } else {
                dialectDiv.classList.add('hidden');
                if (currentLanguage === 'en') {
                    topic.placeholder = 'Enter article topic...';
                    keywords.placeholder = 'Leave empty for auto-generation or enter custom keywords';
                    document.getElementById('btnText').textContent = 'Generate Article';
                } else {
                    topic.placeholder = 'Entrez le sujet...';
                    keywords.placeholder = 'Laissez vide pour génération automatique';
                    document.getElementById('btnText').textContent = 'Générer l\'article';
                }
            }
        });

        async function callAPI(messages, maxTokens = 1000) {
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'claude-sonnet-4-20250514',
                    max_tokens: maxTokens,
                    messages: messages
                })
            });
            
            const data = await response.json();
            return data.content[0].text;
        }

        function buildPrompt(topic, keywords, language, dialect) {
            const dialectInstructions = {
                standard: 'اكتب بالعربية الفصحى',
                dz: 'اكتب باللهجة الجزائرية العامية بطريقة طبيعية (استخدم كلمات مثل: راني، نروح، بصح، برك، كاين)',
                eg: 'اكتب باللهجة المصرية العامية بطريقة طبيعية (استخدم كلمات مثل: عايز، بتاع، علشان، خالص، ده)',
                tn: 'اكتب باللهجة التونسية العامية بطريقة طبيعية (استخدم كلمات مثل: باهي، برشا، توة، ياسر، مالا)',
                ma: 'اكتب باللهجة المغربية العامية بطريقة طبيعية (استخدم كلمات مثل: بغيت، غادي، بزاف، واخا، فين)',
                jo: 'اكتب باللهجة الأردنية العامية بطريقة طبيعية (استخدم كلمات مثل: بدي، هسا، كتير، مشان، يعني)',
                sa: 'اكتب باللهجة السعودية العامية بطريقة طبيعية (استخدم كلمات مثل: ودي، مرة، وايد، لين، زين)'
            };

            if (language === 'ar') {
                return `${dialectInstructions[dialect]}. اكتب مقالة حصرية وطبيعية جداً عن: ${topic}

المتطلبات:
- اكتب بأسلوب إنساني طبيعي تماماً كأنك كاتب محترف
- استخدم تنوع في طول الجمل وبنية الفقرات
- أضف لمسات شخصية وأمثلة واقعية
- تجنب التكرار والأنماط الآلية
- قسم المحتوى إلى فقرات منطقية مع عناوين فرعية
${keywords ? `- دمج الكلمات المفتاحية بشكل طبيعي: ${keywords}` : ''}
- اجعل الأسلوب جذاباً وممتعاً للقراءة`;
            } else if (language === 'en') {
                return `Write an exclusive, natural, and highly human-like article about: ${topic}

Requirements:
- Write in a very natural, human style
- Use varied sentence lengths and structures
- Add personal touches and examples
- Avoid repetition and mechanical patterns
- Divide content into logical paragraphs with subheadings
${keywords ? `- Naturally incorporate these keywords: ${keywords}` : ''}`;
            } else {
                return `Rédigez un article exclusif et naturel sur: ${topic}

Exigences:
- Écrivez naturellement comme un professionnel
- Variez les structures de phrases
- Ajoutez des exemples concrets
- Évitez la répétition
- Divisez en paragraphes logiques
${keywords ? `- Incorporez ces mots-clés: ${keywords}` : ''}`;
            }
        }

        async function generateArticle() {
            const topic = document.getElementById('topic').value.trim();
            const language = document.getElementById('language').value;
            const dialect = document.getElementById('dialect').value;
            const articleLength = document.getElementById('articleLength').value;
            const customKeywords = document.getElementById('keywords').value.trim();

            if (!topic) {
                alert(language === 'ar' ? 'الرجاء إدخال موضوع المقالة' : language === 'fr' ? 'Veuillez entrer un sujet' : 'Please enter a topic');
                return;
            }

            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            btn.disabled = true;
            btnText.innerHTML = '<span class="spinner"></span>' + (language === 'ar' ? 'جاري التوليد...' : language === 'fr' ? 'Génération...' : 'Generating...');

            try {
                // Step 1: Generate keywords
                const keywordsPrompt = language === 'ar'
                    ? `بناءً على موضوع: "${topic}"، اقترح 8-12 كلمة مفتاحية مهمة لتحسين SEO. أعطني الكلمات مفصولة بفواصل فقط.`
                    : language === 'fr'
                    ? `Pour le sujet: "${topic}", suggérez 8-12 mots-clés SEO. Donnez uniquement les mots-clés séparés par des virgules.`
                    : `For topic: "${topic}", suggest 8-12 SEO keywords. Give only keywords separated by commas.`;

                const generatedKeywords = await callAPI([{ role: 'user', content: keywordsPrompt }], 200);
                currentKeywords = customKeywords || generatedKeywords.trim();
                
                document.getElementById('generatedKeywords').textContent = currentKeywords;
                document.getElementById('generatedKeywordsDiv').classList.remove('hidden');

                // Step 2: Generate image query
                const imageQuery = await callAPI([{ 
                    role: 'user', 
                    content: `Based on: "${topic}", create a 2-4 word English search query for an image. Give only the search terms.`
                }], 50);

                currentImage = `https://source.unsplash.com/1200x675/?${encodeURIComponent(imageQuery.trim().replace(/["\n]/g, ''))}`;

                // Step 3: Generate article
                const articlePrompt = buildPrompt(topic, currentKeywords, language, dialect);
                currentArticle = await callAPI([{ role: 'user', content: articlePrompt }], lengthOptions[articleLength]);

                // Step 4: Generate title
                const titlePrompt = language === 'ar'
                    ? `بناءً على المقالة، اقترح عنواناً جذاباً (5-10 كلمات). العنوان فقط:\n\n${currentArticle.substring(0, 500)}`
                    : language === 'fr'
                    ? `Pour cet article, suggérez un titre accrocheur (5-10 mots). Titre uniquement:\n\n${currentArticle.substring(0, 500)}`
                    : `For this article, suggest a catchy title (5-10 words). Title only:\n\n${currentArticle.substring(0, 500)}`;

                currentTitle = (await callAPI([{ role: 'user', content: titlePrompt }], 100)).trim().replace(/["\n]/g, '');

                // Display results
                displayResults();

            } catch (error) {
                console.error('Error:', error);
                alert(language === 'ar' ? 'حدث خطأ في توليد المقالة' : 'Error generating article');
            } finally {
                btn.disabled = false;
                btnText.innerHTML = '<svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>' + 
                    (language === 'ar' ? 'توليد المقالة' : language === 'fr' ? 'Générer l\'article' : 'Generate Article');
            }
        }

        function displayResults() {
            document.getElementById('articleTitle').textContent = currentTitle;
            document.getElementById('articleTitle').dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
            
            if (currentImage) {
                document.getElementById('articleImage').src = currentImage;
                document.getElementById('articleImage').alt = currentTitle;
                document.getElementById('imageContainer').classList.remove('hidden');
            }

            const content = document.getElementById('articleContent');
            content.innerHTML = '';
            content.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
            
            const paragraphs = currentArticle.split('\n\n').filter(p => p.trim());
            paragraphs.forEach(paragraph => {
                const p = document.createElement('p');
                p.textContent = paragraph;
                p.className = 'mb-4 text-gray-800 leading-relaxed';
                content.appendChild(p);
            });

            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function copyText() {
            navigator.clipboard.writeText(currentArticle);
            const btn = document.getElementById('copyTextBtn');
            btn.textContent = '✓ تم النسخ';
            setTimeout(() => btn.textContent = 'نسخ نص عادي', 2000);
        }

        function copyHTML() {
            const html = `<!DOCTYPE html>
<html lang="${currentLanguage}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${currentTitle}</title>
    <meta name="description" content="${currentArticle.substring(0, 160).replace(/"/g, '&quot;')}">
    <meta name="keywords" content="${currentKeywords}">
    <meta property="og:title" content="${currentTitle}">
    <meta property="og:description" content="${currentArticle.substring(0, 160).replace(/"/g, '&quot;')}">
    <meta property="og:image" content="${currentImage}">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.8;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            ${currentLanguage === 'ar' ? 'direction: rtl; text-align: right;' : ''}
        }
        .featured-image {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
    </style>
</head>
<body>
    <article>
        <h1>${currentTitle}</h1>
        <img src="${currentImage}" alt="${currentTitle}" class="featured-image">
        ${currentArticle.split('\n\n').filter(p => p.trim()).map(p => `<p>${p}</p>`).join('\n        ')}
    </article>
</body>
</html>`;

            navigator.clipboard.writeText(html);
            const btn = document.getElementById('copyHTMLBtn');
            btn.textContent = '✓ تم النسخ';
            setTimeout(() => btn.textContent = 'نسخ HTML', 2000);
        }
    </script>
</body>
</html>
